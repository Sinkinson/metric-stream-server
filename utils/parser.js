const pb = require('google-protobuf');

const pbMetrics = require('./opentelemetry/proto/collector/metrics/v1/metrics_service_pb');
const toUint8Array = require('base64-to-uint8array');

function parseRecord(body) {
  const metric = JSON.parse(JSON.stringify(body));
  return metric;
}

// function parseRecord(data) {
    
//     const result = [];

//     while (data.length) {
//         const reader = new pb.BinaryReader(data)
//         const messageLength = reader.decoder_.readUnsignedVarint32()
//         const messageFrom = reader.decoder_.cursor_
//         const messageTo = messageFrom + messageLength
//         const message = data.subarray(messageFrom, messageTo)

//         const parsed = pbMetrics.ExportMetricsServiceRequest.deserializeBinary(message);

//         console.log(parsed);
//         result.push(parsed.toObject())

//         data = data.subarray(messageTo)
//     }

//     return result
// }



// {
//   records: [
//     { data: ... },
//     { data: ... },
//   ]
// }
// const records = [
//   'vhMKuxMKvwEKFwoOY2xvdWQucHJvdmlkZXISBQoDYXdzCiIKEGNsb3VkLmFjY291bnQuaWQSDgoMOTQ0MDE4ODkyMTE2Ch4KDGNsb3VkLnJlZ2lvbhIOCgxldS1jZW50cmFsLTEKYAoQYXdzLmV4cG9ydGVyLmFybhJMCkphcm46YXdzOmNsb3Vkd2F0Y2g6ZXUtY2VudHJhbC0xOjk0NDAxODg5MjExNjptZXRyaWMtc3RyZWFtL21ldHJpYy1zdHJlYW0tMRL2ERLeAQo7YW1hem9uYXdzLmNvbS9BV1MvQ2xvdWRXYXRjaC9NZXRyaWNTdHJlYW1zL1B1Ymxpc2hFcnJvclJhdGUaATFamwEKmAEKKQoJTmFtZXNwYWNlEhxBV1MvQ2xvdWRXYXRjaC9NZXRyaWNTdHJlYW1zCh4KCk1ldHJpY05hbWUSEFB1Ymxpc2hFcnJvclJhdGUKIwoQTWV0cmljU3RyZWFtTmFtZRIPbWV0cmljLXN0cmVhbS0xEQCYJZfiCx4XGQDwbI/wCx4XIQIAAAAAAAAAMgAyCQkAAAAAAADwPxL7AQo8YW1hem9uYXdzLmNvbS9BV1MvQ2xvdWRXYXRjaC9NZXRyaWNTdHJlYW1zL1RvdGFsTWV0cmljVXBkYXRlGgExWrcBCrQBCikKCU5hbWVzcGFjZRIcQVdTL0Nsb3VkV2F0Y2gvTWV0cmljU3RyZWFtcwofCgpNZXRyaWNOYW1lEhFUb3RhbE1ldHJpY1VwZGF0ZQojChBNZXRyaWNTdHJlYW1OYW1lEg9tZXRyaWMtc3RyZWFtLTERAJgll+ILHhcZAPBsj/ALHhchAgAAAAAAAAApAAAAAAAAQEAyCREAAAAAAAAqQDISCQAAAAAAAPA/EQAAAAAAADNAEsQBCilhbWF6b25hd3MuY29tL0FXUy9GaXJlaG9zZS9LTVNLZXlEaXNhYmxlZBoHe0NvdW50fVqNAQqKAQoZCglOYW1lc3BhY2USDEFXUy9GaXJlaG9zZQocCgpNZXRyaWNOYW1lEg5LTVNLZXlEaXNhYmxlZAonChJEZWxpdmVyeVN0cmVhbU5hbWUSEW1ldHJpYy1maXJlaG9zZS0xEQBA3p7UCx4XGQCYJZfiCx4XIUAAAAAAAAAAMgAyCQkAAAAAAADwPxLMAQo3YW1hem9uYXdzLmNvbS9BV1MvQ2xvdWRXYXRjaC9NZXRyaWNTdHJlYW1zL01ldHJpY1VwZGF0ZRoBMVqNAQqKAQopCglOYW1lc3BhY2USHEFXUy9DbG91ZFdhdGNoL01ldHJpY1N0cmVhbXMKGgoKTWV0cmljTmFtZRIMTWV0cmljVXBkYXRlEQCYJZfiCx4XGQDwbI/wCx4XIQIAAAAAAAAAKQAAAAAAAEBAMgkRAAAAAAAAKkAyEgkAAAAAAADwPxEAAAAAAAAzQBLIAQorYW1hem9uYXdzLmNvbS9BV1MvRmlyZWhvc2UvVGhyb3R0bGVkUmVjb3JkcxoHe0NvdW50fVqPAQqMAQoZCglOYW1lc3BhY2USDEFXUy9GaXJlaG9zZQoeCgpNZXRyaWNOYW1lEhBUaHJvdHRsZWRSZWNvcmRzCicKEkRlbGl2ZXJ5U3RyZWFtTmFtZRIRbWV0cmljLWZpcmVob3NlLTERAJgll+ILHhcZAPBsj/ALHhchAgAAAAAAAAAyADIJCQAAAAAAAPA/EvUBCiFhbWF6b25hd3MuY29tL0FXUy9Vc2FnZS9DYWxsQ291bnQaATFazAEKyQEKFgoJTmFtZXNwYWNlEglBV1MvVXNhZ2UKFwoKTWV0cmljTmFtZRIJQ2FsbENvdW50Cg0KBUNsYXNzEgROb25lCiAKCFJlc291cmNlEhREZXNjcmliZUFsYXJtSGlzdG9yeQoVCgdTZXJ2aWNlEgpDbG91ZFdhdGNoCgsKBFR5cGUSA0FQSREAmCWX4gseFxkA8GyP8AseFyEBAAAAAAAAACkAAAAAAADwPzIJEQAAAAAAAPA/MhIJAAAAAAAA8D8RAAAAAAAA8D8S8QEKN2FtYXpvbmF3cy5jb20vQVdTL0Nsb3VkV2F0Y2gvTWV0cmljU3RyZWFtcy9NZXRyaWNVcGRhdGUaATFasgEKrwEKKQoJTmFtZXNwYWNlEhxBV1MvQ2xvdWRXYXRjaC9NZXRyaWNTdHJlYW1zChoKCk1ldHJpY05hbWUSDE1ldHJpY1VwZGF0ZQojChBNZXRyaWNTdHJlYW1OYW1lEg9tZXRyaWMtc3RyZWFtLTERAJgll+ILHhcZAPBsj/ALHhchAgAAAAAAAAApAAAAAAAAQEAyCREAAAAAAAAqQDISCQAAAAAAAPA/EQAAAAAAADNAEu4BCiFhbWF6b25hd3MuY29tL0FXUy9Vc2FnZS9DYWxsQ291bnQaATFaxQEKwgEKFgoJTmFtZXNwYWNlEglBV1MvVXNhZ2UKFwoKTWV0cmljTmFtZRIJQ2FsbENvdW50Cg0KBUNsYXNzEgROb25lChkKCFJlc291cmNlEg1HZXRNZXRyaWNEYXRhChUKB1NlcnZpY2USCkNsb3VkV2F0Y2gKCwoEVHlwZRIDQVBJEQCYJZfiCx4XGQDwbI/wCx4XIQEAAAAAAAAAKQAAAAAAAPA/MgkRAAAAAAAA8D8yEgkAAAAAAADwPxEAAAAAAADwPxLYAQooYW1hem9uYXdzLmNvbS9BV1MvRmlyZWhvc2UvSW5jb21pbmdCeXRlcxoCQnlapwEKpAEKGQoJTmFtZXNwYWNlEgxBV1MvRmlyZWhvc2UKGwoKTWV0cmljTmFtZRINSW5jb21pbmdCeXRlcwonChJEZWxpdmVyeVN0cmVhbU5hbWUSEW1ldHJpYy1maXJlaG9zZS0xEQCYJZfiCx4XGQDwbI/wCx4XIQIAAAAAAAAAKQAAAAAAOr1AMgkRAAAAAABKqEAyEgkAAAAAAADwPxEAAAAAABWxQBL7AQolYW1hem9uYXdzLmNvbS9BV1MvVXNhZ2UvUmVzb3VyY2VDb3VudBoBMVrOAQrLAQoWCglOYW1lc3BhY2USCUFXUy9Vc2FnZQobCgpNZXRyaWNOYW1lEg1SZXNvdXJjZUNvdW50Cg0KBUNsYXNzEgROb25lChsKCFJlc291cmNlEg9EZWxpdmVyeVN0cmVhbXMKEwoHU2VydmljZRIIRmlyZWhvc2UKEAoEVHlwZRIIUmVzb3VyY2URAJgll+ILHhcZAPBsj/ALHhchAQAAAAAAAAApAAAAAAAA8D8yCREAAAAAAADwPzISCQAAAAAAAPA/EQAAAAAAAPA/',
//   'kCcKjScKvwEKFwoOY2xvdWQucHJvdmlkZXISBQoDYXdzCiIKEGNsb3VkLmFjY291bnQuaWQSDgoMOTQ0MDE4ODkyMTE2Ch4KDGNsb3VkLnJlZ2lvbhIOCgxldS1jZW50cmFsLTEKYAoQYXdzLmV4cG9ydGVyLmFybhJMCkphcm46YXdzOmNsb3Vkd2F0Y2g6ZXUtY2VudHJhbC0xOjk0NDAxODg5MjExNjptZXRyaWMtc3RyZWFtL21ldHJpYy1zdHJlYW0tMRLIJRLkAQo5YW1hem9uYXdzLmNvbS9BV1MvRmlyZWhvc2UvRGVsaXZlcnlUb0h0dHBFbmRwb2ludC5SZWNvcmRzGgd7Q291bnR9Wp0BCpoBChkKCU5hbWVzcGFjZRIMQVdTL0ZpcmVob3NlCiwKCk1ldHJpY05hbWUSHkRlbGl2ZXJ5VG9IdHRwRW5kcG9pbnQuUmVjb3JkcwonChJEZWxpdmVyeVN0cmVhbU5hbWUSEW1ldHJpYy1maXJlaG9zZS0xEQCYJZfiCx4XGQDwbI/wCx4XIQIAAAAAAAAAMgAyCQkAAAAAAADwPxK3AQo7YW1hem9uYXdzLmNvbS9BV1MvQ2xvdWRXYXRjaC9NZXRyaWNTdHJlYW1zL1B1Ymxpc2hFcnJvclJhdGUaATFadQpzCikKCU5hbWVzcGFjZRIcQVdTL0Nsb3VkV2F0Y2gvTWV0cmljU3RyZWFtcwoeCgpNZXRyaWNOYW1lEhBQdWJsaXNoRXJyb3JSYXRlEQCYJZfiCx4XGQDwbI/wCx4XIQIAAAAAAAAAMgAyCQkAAAAAAADwPxLmAQovYW1hem9uYXdzLmNvbS9BV1MvRmlyZWhvc2UvUHV0UmVjb3JkQmF0Y2guQnl0ZXMaAkJ5Wq4BCqsBChkKCU5hbWVzcGFjZRIMQVdTL0ZpcmVob3NlCiIKCk1ldHJpY05hbWUSFFB1dFJlY29yZEJhdGNoLkJ5dGVzCicKEkRlbGl2ZXJ5U3RyZWFtTmFtZRIRbWV0cmljLWZpcmVob3NlLTERAJgll+ILHhcZAPBsj/ALHhchAgAAAAAAAAApAAAAAAA6vUAyCREAAAAAAEqoQDISCQAAAAAAAPA/EQAAAAAAFbFAEpECCkJhbWF6b25hd3MuY29tL0FXUy9GaXJlaG9zZS9EZWxpdmVyeVRvSHR0cEVuZHBvaW50LlByb2Nlc3NlZFJlY29yZHMaB3tDb3VudH1awQEKvgEKGQoJTmFtZXNwYWNlEgxBV1MvRmlyZWhvc2UKNQoKTWV0cmljTmFtZRInRGVsaXZlcnlUb0h0dHBFbmRwb2ludC5Qcm9jZXNzZWRSZWNvcmRzCicKEkRlbGl2ZXJ5U3RyZWFtTmFtZRIRbWV0cmljLWZpcmVob3NlLTERAJgll+ILHhcZAPBsj/ALHhchAgAAAAAAAAApAAAAAAAAGEAyCREAAAAAAAAIQDISCQAAAAAAAPA/EQAAAAAAAAhAEukBCi5hbWF6b25hd3MuY29tL0FXUy9GaXJlaG9zZS9JbmNvbWluZ1B1dFJlcXVlc3RzGgd7Q291bnR9Wq0BCqoBChkKCU5hbWVzcGFjZRIMQVdTL0ZpcmVob3NlCiEKCk1ldHJpY05hbWUSE0luY29taW5nUHV0UmVxdWVzdHMKJwoSRGVsaXZlcnlTdHJlYW1OYW1lEhFtZXRyaWMtZmlyZWhvc2UtMREAmCWX4gseFxkA8GyP8AseFyECAAAAAAAAACkAAAAAAAAAQDIJEQAAAAAAAPA/MhIJAAAAAAAA8D8RAAAAAAAA8D8S5AEKOWFtYXpvbmF3cy5jb20vQVdTL0ZpcmVob3NlL0RlbGl2ZXJ5VG9IdHRwRW5kcG9pbnQuU3VjY2VzcxoHe0NvdW50fVqdAQqaAQoZCglOYW1lc3BhY2USDEFXUy9GaXJlaG9zZQosCgpNZXRyaWNOYW1lEh5EZWxpdmVyeVRvSHR0cEVuZHBvaW50LlN1Y2Nlc3MKJwoSRGVsaXZlcnlTdHJlYW1OYW1lEhFtZXRyaWMtZmlyZWhvc2UtMREAmCWX4gseFxkA8GyP8AseFyEDAAAAAAAAADIAMgkJAAAAAAAA8D8SzAEKLWFtYXpvbmF3cy5jb20vQVdTL0ZpcmVob3NlL0tNU0tleUludmFsaWRTdGF0ZRoHe0NvdW50fVqRAQqOAQoZCglOYW1lc3BhY2USDEFXUy9GaXJlaG9zZQogCgpNZXRyaWNOYW1lEhJLTVNLZXlJbnZhbGlkU3RhdGUKJwoSRGVsaXZlcnlTdHJlYW1OYW1lEhFtZXRyaWMtZmlyZWhvc2UtMREAmCWX4gseFxkA8GyP8AseFyE/AAAAAAAAADIAMgkJAAAAAAAA8D8S8QEKMmFtYXpvbmF3cy5jb20vQVdTL0ZpcmVob3NlL1B1dFJlY29yZEJhdGNoLlJlcXVlc3RzGgd7Q291bnR9WrEBCq4BChkKCU5hbWVzcGFjZRIMQVdTL0ZpcmVob3NlCiUKCk1ldHJpY05hbWUSF1B1dFJlY29yZEJhdGNoLlJlcXVlc3RzCicKEkRlbGl2ZXJ5U3RyZWFtTmFtZRIRbWV0cmljLWZpcmVob3NlLTERAJgll+ILHhcZAPBsj/ALHhchAgAAAAAAAAApAAAAAAAAAEAyCREAAAAAAADwPzISCQAAAAAAAPA/EQAAAAAAAPA/EoUCCj9hbWF6b25hd3MuY29tL0FXUy9GaXJlaG9zZS9EZWxpdmVyeVRvSHR0cEVuZHBvaW50LkRhdGFGcmVzaG5lc3MaAXNavgEKuwEKGQoJTmFtZXNwYWNlEgxBV1MvRmlyZWhvc2UKMgoKTWV0cmljTmFtZRIkRGVsaXZlcnlUb0h0dHBFbmRwb2ludC5EYXRhRnJlc2huZXNzCicKEkRlbGl2ZXJ5U3RyZWFtTmFtZRIRbWV0cmljLWZpcmVob3NlLTERAJgll+ILHhcZAPBsj/ALHhchBAAAAAAAAAApAAAAAADQc0AyCREAAAAAAIBSQDISCQAAAAAAAPA/EQAAAAAAQFRAEu8BCjFhbWF6b25hd3MuY29tL0FXUy9GaXJlaG9zZS9QdXRSZWNvcmRCYXRjaC5SZWNvcmRzGgd7Q291bnR9WrABCq0BChkKCU5hbWVzcGFjZRIMQVdTL0ZpcmVob3NlCiQKCk1ldHJpY05hbWUSFlB1dFJlY29yZEJhdGNoLlJlY29yZHMKJwoSRGVsaXZlcnlTdHJlYW1OYW1lEhFtZXRyaWMtZmlyZWhvc2UtMREAmCWX4gseFxkA8GyP8AseFyECAAAAAAAAACkAAAAAAAAAQDIJEQAAAAAAAPA/MhIJAAAAAAAA8D8RAAAAAAAA8D8SiAIKQGFtYXpvbmF3cy5jb20vQVdTL0ZpcmVob3NlL0RlbGl2ZXJ5VG9IdHRwRW5kcG9pbnQuUHJvY2Vzc2VkQnl0ZXMaAkJ5Wr8BCrwBChkKCU5hbWVzcGFjZRIMQVdTL0ZpcmVob3NlCjMKCk1ldHJpY05hbWUSJURlbGl2ZXJ5VG9IdHRwRW5kcG9pbnQuUHJvY2Vzc2VkQnl0ZXMKJwoSRGVsaXZlcnlTdHJlYW1OYW1lEhFtZXRyaWMtZmlyZWhvc2UtMREAmCWX4gseFxkA8GyP8AseFyECAAAAAAAAACkAAAAAAAzbQDIJEQAAAAAADMtAMhIJAAAAAAAA8D8RAAAAAAAMy0ASxAEKKWFtYXpvbmF3cy5jb20vQVdTL0ZpcmVob3NlL0tNU0tleU5vdEZvdW5kGgd7Q291bnR9Wo0BCooBChkKCU5hbWVzcGFjZRIMQVdTL0ZpcmVob3NlChwKCk1ldHJpY05hbWUSDktNU0tleU5vdEZvdW5kCicKEkRlbGl2ZXJ5U3RyZWFtTmFtZRIRbWV0cmljLWZpcmVob3NlLTERAJgll+ILHhcZAPBsj/ALHhchPwAAAAAAAAAyADIJCQAAAAAAAPA/EusBCi9hbWF6b25hd3MuY29tL0FXUy9GaXJlaG9zZS9EZWxpdmVyeVRvUzMuU3VjY2VzcxoHe0NvdW50fVquAQqrAQoZCglOYW1lc3BhY2USDEFXUy9GaXJlaG9zZQoiCgpNZXRyaWNOYW1lEhREZWxpdmVyeVRvUzMuU3VjY2VzcwonChJEZWxpdmVyeVN0cmVhbU5hbWUSEW1ldHJpYy1maXJlaG9zZS0xEQCYJZfiCx4XGQDwbI/wCx4XIQEAAAAAAAAAKQAAAAAAAPA/MgkRAAAAAAAA8D8yEgkAAAAAAADwPxEAAAAAAADwPxLMAQotYW1hem9uYXdzLmNvbS9BV1MvRmlyZWhvc2UvS01TS2V5QWNjZXNzRGVuaWVkGgd7Q291bnR9WpEBCo4BChkKCU5hbWVzcGFjZRIMQVdTL0ZpcmVob3NlCiAKCk1ldHJpY05hbWUSEktNU0tleUFjY2Vzc0RlbmllZAonChJEZWxpdmVyeVN0cmVhbU5hbWUSEW1ldHJpYy1maXJlaG9zZS0xEQCYJZfiCx4XGQDwbI/wCx4XIT8AAAAAAAAAMgAyCQkAAAAAAADwPxLuAQogYW1hem9uYXdzLmNvbS9BV1MvTG9ncy9DYWxsQ291bnQaATFaxgEKwwEKFQoJTmFtZXNwYWNlEghBV1MvTG9ncwoXCgpNZXRyaWNOYW1lEglDYWxsQ291bnQKDQoFQ2xhc3MSBE5vbmUKIQoIUmVzb3VyY2USFURlc2NyaWJlTWV0cmljRmlsdGVycwoPCgdTZXJ2aWNlEgRMb2dzCgsKBFR5cGUSA0FQSREAmCWX4gseFxkA8GyP8AseFyECAAAAAAAAACkAAAAAAAAAQDIJEQAAAAAAAPA/MhIJAAAAAAAA8D8RAAAAAAAA8D8S6gEKMWFtYXpvbmF3cy5jb20vQVdTL0ZpcmVob3NlL1B1dFJlY29yZEJhdGNoLkxhdGVuY3kaAm1zWrABCq0BChkKCU5hbWVzcGFjZRIMQVdTL0ZpcmVob3NlCiQKCk1ldHJpY05hbWUSFlB1dFJlY29yZEJhdGNoLkxhdGVuY3kKJwoSRGVsaXZlcnlTdHJlYW1OYW1lEhFtZXRyaWMtZmlyZWhvc2UtMREAmCWX4gseFxkA8GyP8AseFyECAAAAAAAAACkAAAAAAAAwQDIJEQAAAAAAABhAMhIJAAAAAAAA8D8RAAAAAAAAJEAS2wEKN2FtYXpvbmF3cy5jb20vQVdTL0ZpcmVob3NlL0RlbGl2ZXJ5VG9IdHRwRW5kcG9pbnQuQnl0ZXMaAkJ5WpsBCpgBChkKCU5hbWVzcGFjZRIMQVdTL0ZpcmVob3NlCioKCk1ldHJpY05hbWUSHERlbGl2ZXJ5VG9IdHRwRW5kcG9pbnQuQnl0ZXMKJwoSRGVsaXZlcnlTdHJlYW1OYW1lEhFtZXRyaWMtZmlyZWhvc2UtMREAmCWX4gseFxkA8GyP8AseFyECAAAAAAAAADIAMgkJAAAAAAAA8D8S1gEKPGFtYXpvbmF3cy5jb20vQVdTL0Nsb3VkV2F0Y2gvTWV0cmljU3RyZWFtcy9Ub3RhbE1ldHJpY1VwZGF0ZRoBMVqSAQqPAQopCglOYW1lc3BhY2USHEFXUy9DbG91ZFdhdGNoL01ldHJpY1N0cmVhbXMKHwoKTWV0cmljTmFtZRIRVG90YWxNZXRyaWNVcGRhdGURAJgll+ILHhcZAPBsj/ALHhchAgAAAAAAAAApAAAAAAAAQEAyCREAAAAAAAAqQDISCQAAAAAAAPA/EQAAAAAAADNAEpwBCiBhbWF6b25hd3MuY29tL0FXUy9Mb2dzL0NhbGxDb3VudBoBMVp1CnMKFQoJTmFtZXNwYWNlEghBV1MvTG9ncwoXCgpNZXRyaWNOYW1lEglDYWxsQ291bnQRAJgll+ILHhcZAPBsj/ALHhchAgAAAAAAAAApAAAAAAAAAEAyCREAAAAAAADwPzISCQAAAAAAAPA/EQAAAAAAAPA/EuEBCiphbWF6b25hd3MuY29tL0FXUy9GaXJlaG9zZS9JbmNvbWluZ1JlY29yZHMaB3tDb3VudH1aqQEKpgEKGQoJTmFtZXNwYWNlEgxBV1MvRmlyZWhvc2UKHQoKTWV0cmljTmFtZRIPSW5jb21pbmdSZWNvcmRzCicKEkRlbGl2ZXJ5U3RyZWFtTmFtZRIRbWV0cmljLWZpcmVob3NlLTERAJgll+ILHhcZAPBsj/ALHhchAgAAAAAAAAApAAAAAAAAAEAyCREAAAAAAADwPzISCQAAAAAAAPA/EQAAAAAAAPA/EvABCiFhbWF6b25hd3MuY29tL0FXUy9Vc2FnZS9DYWxsQ291bnQaATFaxwEKxAEKFgoJTmFtZXNwYWNlEglBV1MvVXNhZ2UKFwoKTWV0cmljTmFtZRIJQ2FsbENvdW50Cg0KBUNsYXNzEgROb25lCiEKCFJlc291cmNlEhVEZXNjcmliZU1ldHJpY0ZpbHRlcnMKDwoHU2VydmljZRIETG9ncwoLCgRUeXBlEgNBUEkRAJgll+ILHhcZAPBsj/ALHhchAgAAAAAAAAApAAAAAAAAAEAyCREAAAAAAADwPzISCQAAAAAAAPA/EQAAAAAAAPA/'
// ];

// const arr = toUint8Array(records[1]);
// console.log(parseRecord(arr));

exports.parseRecord = parseRecord;